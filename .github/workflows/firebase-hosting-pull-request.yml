# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on PR
on: pull_request
permissions:
  checks: write
  contents: read
  pull-requests: write

env:
  NEXT_PUBLIC_FIREBASE_API_KEY: ${{ secrets.NEXT_PUBLIC_FIREBASE_API_KEY }}
  NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: "next-auth-demo-project.firebaseapp.com"
  NEXT_PUBLIC_FIREBASE_PROJECT_ID: "next-auth-demo-project"
  NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: "next-auth-demo-project.appspot.com"
  NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: "991306417710"
  NEXT_PUBLIC_FIREBASE_APP_ID: "1:991306417710:web:d2a12ea4165a760c4e81bf"
  NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID: "G-R286HEYC06"
  NEXT_PRIVATE_FIREBASE_API_KEY: |
    ${{ secrets.NEXT_PRIVATE_FIREBASE_API_KEY }}
  
  AUTH_COOKIE_SIGNATURE_KEY_CURRENT: ${{ secrets.AUTH_COOKIE_SIGNATURE_KEY_CURRENT }}
  AUTH_COOKIE_SIGNATURE_KEY_PREVIOUS: ${{ secrets.AUTH_COOKIE_SIGNATURE_KEY_PREVIOUS }}
  AUTH_COOKIE_NAME: "__session"
  USE_SECURE_COOKIES: "true"

jobs:
  build_and_preview:
    if: ${{ github.event.pull_request.head.repo.full_name == github.repository }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - run: npm run build
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_NEXT_AUTH_DEMO_PROJECT }}
          projectId: next-auth-demo-project
        env:
          FIREBASE_CLI_EXPERIMENTS: webframeworks
